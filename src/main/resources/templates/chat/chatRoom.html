<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chat Room</title>
</head>
<body>

<h1 th:text="${room.name}"></h1>

<div>
    <input type="text" id="messageContent" placeholder="Enter your message here">
    <button onclick="sendMessage()">Send</button>
</div>

<div id="chatMessages">
    <div th:each="message : ${messages}">
        <span th:text="${message.createdAt} + ' ' + ${message.content}"></span>
    </div>
</div>

<script>
    const roomId = [[${room.id}]];
    let socket = new WebSocket("ws://localhost:8080/ws/chat");

    socket.onopen = function() {
        console.log("Connected");
    };

    socket.onmessage = function(event) {
        let message = JSON.parse(event.data);
        let chatMessages = document.getElementById("chatMessages");
        let messageElement = document.createElement("div");
        messageElement.innerText = message.createdAt + " " + message.content;
        chatMessages.appendChild(messageElement);
    };

    function sendMessage() {
        let content = document.getElementById("messageContent").value;
        let message = {
            content: content,
            chatRoomId: roomId
        };
        socket.send(JSON.stringify(message));
    }
</script>

</body>
</html>
